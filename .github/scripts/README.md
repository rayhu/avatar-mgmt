# 统一检查脚本

这个目录包含了可在本地和 CI 环境中运行的统一检查脚本。

## 文件说明

- `run-checks.sh` - 主要的检查脚本，运行所有必要的检查

## 使用方法

### 本地运行

```bash
# 在项目根目录运行
./github/scripts/run-checks.sh --local

# 跳过格式化检查（如果只想快速检查）
./github/scripts/run-checks.sh --local --skip-format

# 跳过安全审计（如果网络较慢）
./github/scripts/run-checks.sh --local --skip-audit

# 查看帮助
./github/scripts/run-checks.sh --help
```

### CI 环境运行

在 GitHub Actions 中，脚本会自动检测 CI 环境并设置正确的 Volta 环境。

## 检查内容

### 前端检查

- ✅ ESLint 代码质量检查
- ✅ TypeScript 类型检查
- ✅ i18n 国际化完整性检查
- ✅ 单元测试
- ✅ 构建验证
- ✅ 代码格式化检查和自动修复

### API 服务器检查

- ✅ TypeScript 类型检查
- ✅ 单元测试

### 通用检查

- ✅ 依赖安装验证
- ✅ 安全漏洞审计
- ✅ i18n 报告生成

## 命令行选项

| 选项            | 说明                       |
| --------------- | -------------------------- |
| `--local`       | 本地模式，使用系统环境变量 |
| `--skip-format` | 跳过代码格式化检查         |
| `--skip-audit`  | 跳过安全审计               |
| `--help`        | 显示帮助信息               |

## 环境要求

### 本地环境

- Node.js 22.16.0+
- Yarn 1.22.22+
- 在项目根目录运行

### CI 环境

- Ubuntu 最新版本
- 自动安装 Volta
- 自动安装 Node.js 22.16.0 和 Yarn 1.22.22

## 输出示例

```
ℹ️  开始运行统一检查...
ℹ️  模式: 本地
ℹ️  跳过格式化: 否
ℹ️  跳过审计: 否

ℹ️  本地模式：使用系统环境
ℹ️  Node.js 版本: v22.16.0
ℹ️  Yarn 版本: 1.22.22

ℹ️  安装前端依赖...
ℹ️  安装 API 服务器依赖...

ℹ️  运行前端检查...
🔍 运行 ESLint...
🔍 运行 TypeScript 类型检查...
🌐 运行 i18n 检查...
🧪 运行测试...
🏗️ 运行构建检查...
✅ 前端检查完成

✅ 所有检查完成！
ℹ️  如果看到警告，请检查并修复相关问题
```

## 故障排除

### 常见问题

1. **权限错误**: 确保脚本有执行权限 `chmod +x .github/scripts/run-checks.sh`
2. **目录错误**: 确保在项目根目录运行脚本
3. **依赖缺失**: 确保已安装 Node.js 和 Yarn
4. **Volta 问题**: 在 CI 中确保 Volta 正确安装

### 调试模式

脚本使用 `set -e`，任何步骤失败都会停止执行。查看具体错误信息来定位问题。

## 维护

- 脚本同时支持本地和 CI 环境
- 添加新检查时，同时更新脚本和 workflow
- 保持脚本的可读性和可维护性
