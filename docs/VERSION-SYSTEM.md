# ğŸ”§ ç‰ˆæœ¬ç³»ç»Ÿä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬ç‰ˆæœ¬ç³»ç»Ÿä¸º Avatar Management é¡¹ç›®æä¾›å®Œæ•´çš„ç‰ˆæœ¬è¿½è¸ªåŠŸèƒ½ï¼ŒåŒ…æ‹¬å‰ç«¯ã€åç«¯å’Œç³»ç»Ÿçš„ç‰ˆæœ¬ä¿¡æ¯ã€Git æäº¤è®°å½•ã€æ„å»ºæ—¶é—´å’Œè¿è¡ŒçŠ¶æ€ã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯ç‰ˆæœ¬ä¿¡æ¯   â”‚    â”‚   åç«¯ç‰ˆæœ¬ä¿¡æ¯   â”‚    â”‚   ç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯   â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ â€¢ ç‰ˆæœ¬å·        â”‚    â”‚ â€¢ ç‰ˆæœ¬å·        â”‚    â”‚ â€¢ ç¯å¢ƒæ ‡è¯†      â”‚
â”‚ â€¢ Commit Hash   â”‚    â”‚ â€¢ Commit Hash   â”‚    â”‚ â€¢ éƒ¨ç½²æ—¶é—´      â”‚
â”‚ â€¢ æ„å»ºæ—¶é—´      â”‚    â”‚ â€¢ æ„å»ºæ—¶é—´      â”‚    â”‚ â€¢ è¿è¡Œæ—¶é—´      â”‚
â”‚ â€¢ Git åˆ†æ”¯      â”‚    â”‚ â€¢ Git åˆ†æ”¯      â”‚    â”‚ â€¢ éƒ¨ç½²ID        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   ç‰ˆæœ¬APIç«¯ç‚¹    â”‚
                    â”‚                 â”‚
                    â”‚ GET /api/versionâ”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç”Ÿæˆç‰ˆæœ¬ä¿¡æ¯

```bash
# ç”Ÿæˆç‰ˆæœ¬ä¿¡æ¯
./scripts/deploy/version.sh generate

# æˆ–è€…ä½¿ç”¨éƒ¨ç½²è„šæœ¬
./scripts/deploy/main.sh version generate
```

### 2. æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯

```bash
# è®¿é—®å‰ç«¯é¡µé¢
http://localhost:3000/version

# è®¿é—®APIç«¯ç‚¹
curl http://localhost:3000/api/version
```

### 3. éƒ¨ç½²æ—¶è‡ªåŠ¨ç”Ÿæˆ

```bash
# æ„å»ºæ—¶è‡ªåŠ¨ç”Ÿæˆç‰ˆæœ¬ä¿¡æ¯
./scripts/deploy/main.sh build --all

# éƒ¨ç½²æ—¶è‡ªåŠ¨ç”Ÿæˆç‰ˆæœ¬ä¿¡æ¯
./scripts/deploy/main.sh version deploy
```

## ğŸ“ æ–‡ä»¶ç»“æ„

```
project/
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ deploy/
â”‚   â”‚   â”œâ”€â”€ version.sh          # ç‰ˆæœ¬ç®¡ç†è„šæœ¬
â”‚   â”‚   â””â”€â”€ main.sh             # ä¸»éƒ¨ç½²è„šæœ¬
â”‚   â””â”€â”€ generate-version.sh     # ç®€å•ç‰ˆæœ¬ç”Ÿæˆè„šæœ¬
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â””â”€â”€ version/            # å‰ç«¯ç‰ˆæœ¬ä¿¡æ¯
â”‚   â”‚       â”œâ”€â”€ frontend.json   # å‰ç«¯ç‰ˆæœ¬
â”‚   â”‚       â”œâ”€â”€ backend.json    # åç«¯ç‰ˆæœ¬
â”‚   â”‚       â”œâ”€â”€ system.json     # ç³»ç»Ÿä¿¡æ¯
â”‚   â”‚       â””â”€â”€ full.json       # å®Œæ•´ç‰ˆæœ¬ä¿¡æ¯
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ components/
â”‚       â”‚   â””â”€â”€ VersionInfo.vue # ç‰ˆæœ¬ä¿¡æ¯ç»„ä»¶
â”‚       â””â”€â”€ views/
â”‚           â””â”€â”€ VersionInfo.vue # ç‰ˆæœ¬ä¿¡æ¯é¡µé¢
â”œâ”€â”€ api-server/
â”‚   â”œâ”€â”€ handlers/
â”‚   â”‚   â””â”€â”€ version.ts          # ç‰ˆæœ¬APIå¤„ç†å™¨
â”‚   â””â”€â”€ version/                # åç«¯ç‰ˆæœ¬ä¿¡æ¯
â”‚       â”œâ”€â”€ frontend.json
â”‚       â”œâ”€â”€ backend.json
â”‚       â”œâ”€â”€ system.json
â”‚       â””â”€â”€ full.json
â””â”€â”€ version.json                 # æ ¹ç›®å½•ç‰ˆæœ¬ä¿¡æ¯
```

## ğŸ”§ è„šæœ¬å‘½ä»¤

### ç‰ˆæœ¬ç®¡ç†è„šæœ¬ (`scripts/deploy/version.sh`)

```bash
# ç”Ÿæˆç‰ˆæœ¬ä¿¡æ¯
./scripts/deploy/version.sh generate

# æ¸…ç†ç‰ˆæœ¬ä¿¡æ¯
./scripts/deploy/version.sh clean

# éƒ¨ç½²ç‰ˆæœ¬ä¿¡æ¯
./scripts/deploy/version.sh deploy

# æ˜¾ç¤ºå¸®åŠ©
./scripts/deploy/version.sh help
```

### ç¯å¢ƒå˜é‡

```bash
# è®¾ç½®ç¯å¢ƒ
export NODE_ENV=production

# è®¾ç½®éƒ¨ç½²ID
export DEPLOYMENT_ID=deploy_$(date +%s)

# ç”Ÿæˆç‰ˆæœ¬ä¿¡æ¯
./scripts/deploy/version.sh deploy
```

## ğŸŒ å‰ç«¯ä½¿ç”¨

### 1. ç‰ˆæœ¬ä¿¡æ¯ç»„ä»¶

```vue
<template>
  <VersionInfo />
</template>

<script setup>
import VersionInfo from '@/components/VersionInfo.vue'
</script>
```

### 2. ç‰ˆæœ¬ä¿¡æ¯é¡µé¢

è®¿é—® `/version` è·¯ç”±æŸ¥çœ‹å®Œæ•´çš„ç‰ˆæœ¬ä¿¡æ¯é¡µé¢ã€‚

### 3. è‡ªå®šä¹‰æ ·å¼

ç»„ä»¶ä½¿ç”¨ CSS Grid å¸ƒå±€ï¼Œæ”¯æŒå“åº”å¼è®¾è®¡ï¼š

```css
.version-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
}
```

## ğŸ”Œ API ä½¿ç”¨

### ç‰ˆæœ¬ä¿¡æ¯ç«¯ç‚¹

```http
GET /api/version
```

### å“åº”æ ¼å¼

```json
{
  "frontend": {
    "version": "2024.01.15-abc123",
    "commitHash": "abc123",
    "buildTime": "2024-01-15T10:30:00Z",
    "branch": "main",
    "commitDate": "2024-01-15T10:30:00Z",
    "gitTag": "v1.0.0"
  },
  "backend": {
    "version": "2024.01.15-abc123",
    "commitHash": "abc123",
    "buildTime": "2024.01.15T10:30:00Z",
    "branch": "main",
    "commitDate": "2024-01-15T10:30:00Z",
    "gitTag": "v1.0.0"
  },
  "system": {
    "deployTime": "2024-01-15T10:30:00Z",
    "environment": "production",
    "uptime": "3600s",
    "deploymentId": "deploy_1705312200",
    "lastCheck": "2024-01-15T11:30:00Z"
  },
  "api": {
    "endpoint": "/api/version",
    "timestamp": "2024-01-15T11:30:00Z",
    "uptime": "3600s"
  },
  "generatedAt": "2024-01-15T10:30:00Z",
  "deploymentInfo": {
    "deploymentId": "deploy_1705312200",
    "deploymentTime": "2024-01-15T10:30:00Z",
    "deploymentUser": "deploy",
    "deploymentHost": "server-01"
  }
}
```

## ğŸ§ª æµ‹è¯•

### è¿è¡Œç‰ˆæœ¬ç³»ç»Ÿæµ‹è¯•

```bash
# è¿è¡Œç‰ˆæœ¬APIæµ‹è¯•
cd api-server
yarn test tests/handlers/version.test.ts

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
yarn test
```

### æµ‹è¯•è¦†ç›–

- âœ… ç‰ˆæœ¬ä¿¡æ¯ç”Ÿæˆ
- âœ… ç‰ˆæœ¬æ–‡ä»¶è¯»å–
- âœ… é»˜è®¤ç‰ˆæœ¬ä¿¡æ¯
- âœ… é”™è¯¯å¤„ç†
- âœ… API å“åº”æ ¼å¼

## ğŸ”„ éƒ¨ç½²é›†æˆ

### 1. æ„å»ºæ—¶è‡ªåŠ¨ç”Ÿæˆ

åœ¨ `scripts/deploy/modules/build.sh` ä¸­å·²é›†æˆç‰ˆæœ¬ç®¡ç†ï¼š

```bash
# æ„å»ºå®Œæˆåè‡ªåŠ¨ç”Ÿæˆç‰ˆæœ¬ä¿¡æ¯
build_frontend() {
    # ... æ„å»ºé€»è¾‘ ...
    
    # ç”Ÿæˆç‰ˆæœ¬ä¿¡æ¯
    log_info "ç”Ÿæˆç‰ˆæœ¬ä¿¡æ¯..."
    if [ -f "scripts/deploy/version.sh" ]; then
        chmod +x scripts/deploy/version.sh
        ./scripts/deploy/version.sh deploy
    fi
}
```

### 2. éƒ¨ç½²æ—¶è‡ªåŠ¨ç”Ÿæˆ

åœ¨ `scripts/deploy/main.sh` ä¸­å·²é›†æˆç‰ˆæœ¬ç®¡ç†ï¼š

```bash
# ç‰ˆæœ¬ç®¡ç†å‘½ä»¤
version)
    source "$MODULES_DIR/version.sh"
    main "$@"
    ;;
```

## ğŸš¨ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

1. **ç‰ˆæœ¬ä¿¡æ¯æ˜¾ç¤º"æœªçŸ¥"**
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - ç¡®è®¤åç«¯æœåŠ¡è¿è¡Œæ­£å¸¸
   - æ£€æŸ¥ç‰ˆæœ¬æ–‡ä»¶æ˜¯å¦å­˜åœ¨

2. **å‰åç«¯ç‰ˆæœ¬ä¸ä¸€è‡´**
   - é‡æ–°ç”Ÿæˆç‰ˆæœ¬ä¿¡æ¯
   - æ£€æŸ¥æ„å»ºæµç¨‹
   - ç¡®è®¤éƒ¨ç½²åŒæ­¥

3. **Git ä¿¡æ¯è·å–å¤±è´¥**
   - ç¡®è®¤åœ¨ Git ä»“åº“ä¸­
   - æ£€æŸ¥ Git æƒé™
   - éªŒè¯ Git é…ç½®

### è°ƒè¯•å‘½ä»¤

```bash
# æ£€æŸ¥ç‰ˆæœ¬æ–‡ä»¶
ls -la frontend/public/version/
ls -la api-server/version/

# æŸ¥çœ‹ç‰ˆæœ¬å†…å®¹
cat version.json | jq '.'

# æµ‹è¯•ç‰ˆæœ¬API
curl -v http://localhost:3000/api/version
```

## ğŸ“ˆ æœ€ä½³å®è·µ

### 1. ç‰ˆæœ¬å·å‘½å

- ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬å·ï¼š`v1.0.0`
- å¼€å‘ç‰ˆæœ¬ï¼š`2024.01.15-abc123`
- é¢„å‘å¸ƒç‰ˆæœ¬ï¼š`v1.0.0-beta.1`

### 2. éƒ¨ç½²æµç¨‹

```bash
# 1. ç”Ÿæˆç‰ˆæœ¬ä¿¡æ¯
./scripts/deploy/version.sh generate

# 2. æ„å»ºåº”ç”¨
./scripts/deploy/main.sh build --all

# 3. éƒ¨ç½²åˆ°æœåŠ¡å™¨
./scripts/deploy/main.sh deploy --full

# 4. éªŒè¯ç‰ˆæœ¬ä¿¡æ¯
curl http://your-domain.com/api/version
```

### 3. ç›‘æ§å’Œå‘Šè­¦

- å®šæœŸæ£€æŸ¥ç‰ˆæœ¬ä¸€è‡´æ€§
- ç›‘æ§éƒ¨ç½²æ—¶é—´
- è®¾ç½®ç‰ˆæœ¬å˜æ›´é€šçŸ¥

## ğŸ”® æœªæ¥æ‰©å±•

### è®¡åˆ’åŠŸèƒ½

- [ ] ç‰ˆæœ¬æ¯”è¾ƒåŠŸèƒ½
- [ ] è‡ªåŠ¨å›æ»šæ£€æµ‹
- [ ] ç‰ˆæœ¬å˜æ›´æ—¥å¿—
- [ ] æ€§èƒ½æŒ‡æ ‡é›†æˆ
- [ ] å¤šç¯å¢ƒç‰ˆæœ¬ç®¡ç†

### è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Request æ¥æ”¹è¿›ç‰ˆæœ¬ç³»ç»Ÿï¼

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [éƒ¨ç½²æŒ‡å—](./DEPLOYMENT.md)
- [API æ–‡æ¡£](./api-server.md)
- [å‰ç«¯å¼€å‘æŒ‡å—](./frontend/README.md)

---

**æœ€åæ›´æ–°**: 2024-01-15  
**ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ  
**ç‰ˆæœ¬**: 1.0.0
