<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>前端日志测试</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f6fa;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
        }
        .section h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 10px 0;
        }
        button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        .btn-primary { background: #42b883; color: white; }
        .btn-primary:hover { background: #369870; }
        .btn-warning { background: #f39c12; color: white; }
        .btn-warning:hover { background: #e67e22; }
        .btn-danger { background: #e74c3c; color: white; }
        .btn-danger:hover { background: #c0392b; }
        .btn-info { background: #3498db; color: white; }
        .btn-info:hover { background: #2980b9; }
        .log-output {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .status.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .status.info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        input, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 5px 0;
        }
        textarea {
            height: 80px;
            resize: vertical;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔍 前端日志系统测试</h1>
        <p>这个页面用于测试前端日志系统的各种功能。</p>

        <div class="section">
            <h3>📊 日志级别测试</h3>
            <div class="button-group">
                <button class="btn-info" onclick="testDebug()">Debug 日志</button>
                <button class="btn-primary" onclick="testInfo()">Info 日志</button>
                <button class="btn-warning" onclick="testWarn()">Warning 日志</button>
                <button class="btn-danger" onclick="testError()">Error 日志</button>
            </div>
        </div>

        <div class="section">
            <h3>🌐 API 调用日志测试</h3>
            <div class="button-group">
                <button class="btn-primary" onclick="testApiCall()">测试 API 调用</button>
                <button class="btn-warning" onclick="testApiError()">测试 API 错误</button>
                <button class="btn-info" onclick="testApiResponse()">测试 API 响应</button>
            </div>
        </div>

        <div class="section">
            <h3>👤 用户交互日志测试</h3>
            <div class="button-group">
                <button class="btn-primary" onclick="testUserAction()">用户操作</button>
                <button class="btn-info" onclick="testRouteChange()">路由跳转</button>
                <button class="btn-warning" onclick="testStoreUpdate()">状态更新</button>
            </div>
        </div>

        <div class="section">
            <h3>⚡ 性能日志测试</h3>
            <div class="button-group">
                <button class="btn-primary" onclick="testPerformance()">性能测试</button>
                <button class="btn-info" onclick="testAsyncOperation()">异步操作</button>
            </div>
        </div>

        <div class="section">
            <h3>🔧 组件日志测试</h3>
            <div class="button-group">
                <button class="btn-primary" onclick="testComponentLog()">组件日志</button>
                <button class="btn-warning" onclick="testComponentError()">组件错误</button>
                <button class="btn-info" onclick="testComponentDebug()">组件调试</button>
            </div>
        </div>

        <div class="section">
            <h3>🎯 自定义日志测试</h3>
            <input type="text" id="customMessage" placeholder="输入自定义消息" value="这是一条自定义日志消息">
            <textarea id="customContext" placeholder="输入上下文信息 (JSON 格式)">{"key": "value", "number": 123}</textarea>
            <div class="button-group">
                <button class="btn-primary" onclick="testCustomLog()">发送自定义日志</button>
                <button class="btn-warning" onclick="testCustomError()">发送自定义错误</button>
            </div>
        </div>

        <div class="section">
            <h3>🧹 日志控制</h3>
            <div class="button-group">
                <button class="btn-info" onclick="clearLogs()">清空控制台</button>
                <button class="btn-warning" onclick="setLogLevel()">设置日志级别</button>
                <button class="btn-primary" onclick="exportLogs()">导出日志</button>
            </div>
        </div>

        <div class="section">
            <h3>📋 日志输出</h3>
            <div class="log-output" id="logOutput">日志将在这里显示...</div>
        </div>
    </div>

    <script>
        // 模拟日志系统
        class MockLogger {
            constructor() {
                this.level = 1; // INFO
                this.isDevelopment = true;
                this.logOutput = document.getElementById('logOutput');
            }

            formatMessage(level, message, context) {
                const timestamp = new Date().toISOString();
                const component = context?.component ? `[${context.component}]` : '';
                const contextStr = context ? ` | ${JSON.stringify(context, null, 2)}` : '';
                return `[${timestamp}] ${level} ${component} ${message}${contextStr}`;
            }

            shouldLog(level) {
                return level >= this.level;
            }

            debug(message, context) {
                if (this.shouldLog(0)) {
                    const logMessage = this.formatMessage('DEBUG', message, context);
                    console.log(logMessage);
                    this.appendToOutput(logMessage);
                }
            }

            info(message, context) {
                if (this.shouldLog(1)) {
                    const logMessage = this.formatMessage('INFO', message, context);
                    console.log(logMessage);
                    this.appendToOutput(logMessage);
                }
            }

            warn(message, context) {
                if (this.shouldLog(2)) {
                    const logMessage = this.formatMessage('WARN', message, context);
                    console.warn(logMessage);
                    this.appendToOutput(logMessage);
                }
            }

            error(message, context) {
                if (this.shouldLog(3)) {
                    const logMessage = this.formatMessage('ERROR', message, context);
                    console.error(logMessage);
                    this.appendToOutput(logMessage);
                }
            }

            apiCall(apiName, url, context) {
                this.info(`🌐 ${apiName} API 调用`, {
                    component: 'API',
                    method: 'API_CALL',
                    url,
                    ...context
                });
            }

            apiResponse(apiName, status, context) {
                const level = status >= 400 ? 'error' : 'info';
                const message = `📥 ${apiName} API 响应`;
                const logContext = {
                    component: 'API',
                    method: 'API_RESPONSE',
                    status,
                    ...context
                };

                if (level === 'error') {
                    this.error(message, logContext);
                } else {
                    this.info(message, logContext);
                }
            }

            apiError(apiName, error, context) {
                this.error(`❌ ${apiName} API 错误`, {
                    component: 'API',
                    method: 'API_ERROR',
                    error: error.message,
                    errorType: error.constructor.name,
                    ...context
                });
            }

            userAction(action, context) {
                this.info(`👤 用户操作: ${action}`, {
                    component: 'USER',
                    method: 'USER_ACTION',
                    ...context
                });
            }

            performance(operation, duration, context) {
                this.info(`⚡ 性能: ${operation}`, {
                    component: 'PERFORMANCE',
                    method: 'PERFORMANCE',
                    duration,
                    ...context
                });
            }

            route(from, to, context) {
                this.info(`🛣️ 路由跳转: ${from} → ${to}`, {
                    component: 'ROUTER',
                    method: 'ROUTE_CHANGE',
                    from,
                    to,
                    ...context
                });
            }

            store(action, state, context) {
                this.debug(`📦 Store 更新: ${action}`, {
                    component: 'STORE',
                    method: 'STORE_UPDATE',
                    action,
                    state,
                    ...context
                });
            }

            component(componentName, message, context) {
                this.info(message, { component: componentName, ...context });
            }

            componentDebug(componentName, message, context) {
                this.debug(message, { component: componentName, ...context });
            }

            componentError(componentName, message, context) {
                this.error(message, { component: componentName, ...context });
            }

            appendToOutput(message) {
                this.logOutput.textContent += message + '\n';
                this.logOutput.scrollTop = this.logOutput.scrollHeight;
            }

            setLevel(level) {
                this.level = level;
                this.info(`日志级别已设置为: ${level}`, {
                    component: 'Logger',
                    method: 'setLevel',
                    newLevel: level
                });
            }
        }

        // 创建全局日志实例
        const logger = new MockLogger();

        // 测试函数
        function testDebug() {
            logger.debug('这是一条调试日志', {
                component: 'TestComponent',
                method: 'testDebug',
                data: { test: true, number: 42 }
            });
        }

        function testInfo() {
            logger.info('这是一条信息日志', {
                component: 'TestComponent',
                method: 'testInfo',
                user: 'testuser',
                action: 'button_click'
            });
        }

        function testWarn() {
            logger.warn('这是一条警告日志', {
                component: 'TestComponent',
                method: 'testWarn',
                warning: 'deprecated_feature',
                suggestion: 'use_new_api'
            });
        }

        function testError() {
            logger.error('这是一条错误日志', {
                component: 'TestComponent',
                method: 'testError',
                error: 'network_timeout',
                retryCount: 3
            });
        }

        function testApiCall() {
            logger.apiCall('Test API', 'https://api.example.com/test', {
                method: 'GET',
                params: { id: 123 }
            });
        }

        function testApiError() {
            logger.apiError('Test API', new Error('Network timeout'), {
                url: 'https://api.example.com/test',
                timeout: 5000
            });
        }

        function testApiResponse() {
            logger.apiResponse('Test API', 200, {
                dataSize: 1024,
                duration: 150
            });
        }

        function testUserAction() {
            logger.userAction('点击测试按钮', {
                buttonId: 'test-btn',
                timestamp: Date.now()
            });
        }

        function testRouteChange() {
            logger.route('/home', '/test', {
                userRole: 'admin',
                isAuthenticated: true
            });
        }

        function testStoreUpdate() {
            logger.store('UPDATE_USER', { name: 'testuser', role: 'admin' }, {
                previousState: { name: 'olduser' }
            });
        }

        function testPerformance() {
            const startTime = Date.now();
            setTimeout(() => {
                const duration = Date.now() - startTime;
                logger.performance('异步操作完成', duration, {
                    operation: 'data_processing',
                    itemsProcessed: 1000
                });
            }, 100);
        }

        function testAsyncOperation() {
            logger.info('开始异步操作', {
                component: 'TestComponent',
                method: 'testAsyncOperation'
            });

            setTimeout(() => {
                logger.info('异步操作完成', {
                    component: 'TestComponent',
                    method: 'testAsyncOperation',
                    duration: 100
                });
            }, 100);
        }

        function testComponentLog() {
            logger.component('TestComponent', '组件状态更新', {
                method: 'updateState',
                newState: { loading: false, data: 'updated' }
            });
        }

        function testComponentError() {
            logger.componentError('TestComponent', '组件渲染失败', {
                method: 'render',
                error: 'invalid_props',
                props: { id: 123 }
            });
        }

        function testComponentDebug() {
            logger.componentDebug('TestComponent', '组件内部状态', {
                method: 'internalState',
                state: { mounted: true, data: null }
            });
        }

        function testCustomLog() {
            const message = document.getElementById('customMessage').value;
            const contextStr = document.getElementById('customContext').value;
            
            try {
                const context = JSON.parse(contextStr);
                logger.info(message, {
                    component: 'CustomTest',
                    method: 'testCustomLog',
                    ...context
                });
            } catch (error) {
                logger.error('解析上下文 JSON 失败', {
                    component: 'CustomTest',
                    method: 'testCustomLog',
                    error: error.message,
                    contextStr
                });
            }
        }

        function testCustomError() {
            const message = document.getElementById('customMessage').value;
            const contextStr = document.getElementById('customContext').value;
            
            try {
                const context = JSON.parse(contextStr);
                logger.error(message, {
                    component: 'CustomTest',
                    method: 'testCustomError',
                    ...context
                });
            } catch (error) {
                logger.error('解析上下文 JSON 失败', {
                    component: 'CustomTest',
                    method: 'testCustomError',
                    error: error.message,
                    contextStr
                });
            }
        }

        function clearLogs() {
            console.clear();
            document.getElementById('logOutput').textContent = '日志已清空...\n';
        }

        function setLogLevel() {
            const level = prompt('设置日志级别 (0=DEBUG, 1=INFO, 2=WARN, 3=ERROR, 4=NONE):', '1');
            if (level !== null) {
                const levelNum = parseInt(level);
                if (!isNaN(levelNum) && levelNum >= 0 && levelNum <= 4) {
                    logger.setLevel(levelNum);
                } else {
                    alert('无效的日志级别');
                }
            }
        }

        function exportLogs() {
            const logs = document.getElementById('logOutput').textContent;
            const blob = new Blob([logs], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `logs-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // 页面加载完成后的初始化
        window.addEventListener('load', () => {
            logger.info('日志测试页面加载完成', {
                component: 'TestPage',
                method: 'onLoad',
                userAgent: navigator.userAgent,
                timestamp: new Date().toISOString()
            });
        });
    </script>
</body>
</html> 
