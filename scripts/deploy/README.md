# Avatar Management éƒ¨ç½²ç³»ç»Ÿ

## ğŸ“‹ **æ¦‚è¿°**

è¿™æ˜¯ä¸€ä¸ªæ¨¡å—åŒ–çš„éƒ¨ç½²ç³»ç»Ÿï¼Œå°†å¤æ‚çš„éƒ¨ç½²æµç¨‹åˆ†è§£ä¸ºç‹¬ç«‹çš„æ¨¡å—ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•ã€‚

## ğŸ—ï¸ **æ¶æ„è®¾è®¡**

### **æ¨¡å—åŒ–ç»“æ„**
```
scripts/deploy/
â”œâ”€â”€ main.sh              # ä¸»å…¥å£è„šæœ¬
â”œâ”€â”€ modules/             # åŠŸèƒ½æ¨¡å—
â”‚   â”œâ”€â”€ common.sh        # é€šç”¨åŠŸèƒ½ï¼ˆæ—¥å¿—ã€é…ç½®ã€é”™è¯¯å¤„ç†ï¼‰
â”‚   â”œâ”€â”€ build.sh         # æ„å»ºæ¨¡å—ï¼ˆå‰ç«¯ã€APIï¼‰
â”‚   â”œâ”€â”€ deploy.sh        # éƒ¨ç½²æ¨¡å—ï¼ˆæœåŠ¡å™¨éƒ¨ç½²ï¼‰
â”‚   â””â”€â”€ config.sh        # é…ç½®æ¨¡å—ï¼ˆJC21é…ç½®ï¼‰
â””â”€â”€ README.md           # è¯´æ˜æ–‡æ¡£
```

### **è®¾è®¡åŸåˆ™**
1. **å•ä¸€èŒè´£** - æ¯ä¸ªæ¨¡å—åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½
2. **å¯å¤ç”¨æ€§** - é€šç”¨åŠŸèƒ½æŠ½è±¡åˆ°commonæ¨¡å—
3. **é”™è¯¯å¤„ç†** - ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
4. **é…ç½®ç®¡ç†** - ç¯å¢ƒå˜é‡å’Œé…ç½®æ–‡ä»¶åˆ†ç¦»

## ğŸš€ **ä½¿ç”¨æ–¹æ³•**

### **åŸºæœ¬ç”¨æ³•**
```bash
# æŸ¥çœ‹å¸®åŠ©
./scripts/deploy/main.sh --help

# æ„å»ºå‰ç«¯
./scripts/deploy/main.sh build --frontend

# å®Œæ•´éƒ¨ç½²
./scripts/deploy/main.sh deploy --full

# é…ç½®JC21
./scripts/deploy/main.sh config --configure

# æµ‹è¯•éƒ¨ç½²
./scripts/deploy/main.sh test
```

### **ç¯å¢ƒå˜é‡**
```bash
export SERVER_HOST="daidai-singapore"
export REMOTE_DIR="/opt/avatar-mgmt"
export DOMAIN="daidai.amis.hk"
```

## ğŸ“¦ **æ¨¡å—è¯´æ˜**

### **1. Common Module (`common.sh`)**
- **åŠŸèƒ½**: åŸºç¡€åŠŸèƒ½å’Œé…ç½®
- **åŒ…å«**: æ—¥å¿—å‡½æ•°ã€é”™è¯¯å¤„ç†ã€SSHè¿æ¥ã€æ–‡ä»¶åŒæ­¥
- **ç‰¹ç‚¹**: è¢«å…¶ä»–æ‰€æœ‰æ¨¡å—å¼•ç”¨

### **2. Build Module (`build.sh`)**
- **åŠŸèƒ½**: æ„å»ºå‰ç«¯å’ŒAPIé•œåƒ
- **é€‰é¡¹**:
  - `--frontend`: åªæ„å»ºå‰ç«¯
  - `--api`: åªæ„å»ºAPIé•œåƒ
  - `--all`: æ„å»ºæ‰€æœ‰ç»„ä»¶

### **3. Deploy Module (`deploy.sh`)**
- **åŠŸèƒ½**: æœåŠ¡å™¨éƒ¨ç½²ç®¡ç†
- **é€‰é¡¹**:
  - `--full`: å®Œæ•´éƒ¨ç½²æµç¨‹
  - `--sync`: åªåŒæ­¥ä»£ç 
  - `--start`: åªå¯åŠ¨æœåŠ¡
  - `--status`: æ£€æŸ¥æœåŠ¡çŠ¶æ€

### **4. Config Module (`config.sh`)**
- **åŠŸèƒ½**: JC21é…ç½®ç®¡ç†
- **é€‰é¡¹**:
  - `--configure`: é…ç½®JC21
  - `--check`: æ£€æŸ¥é…ç½®
  - `--reset`: é‡ç½®é…ç½®
  - `--test`: æµ‹è¯•è¿æ¥

## ğŸ”§ **å¿«é€Ÿå‘½ä»¤**

### **å®Œæ•´éƒ¨ç½²æµç¨‹**
```bash
# 1. æ„å»ºæ‰€æœ‰ç»„ä»¶
./scripts/deploy/main.sh build --all

# 2. éƒ¨ç½²åˆ°æœåŠ¡å™¨
./scripts/deploy/main.sh deploy --full

# 3. é…ç½®JC21
./scripts/deploy/main.sh config --configure

# 4. æµ‹è¯•éƒ¨ç½²
./scripts/deploy/main.sh test
```

### **æ—¥å¸¸ç»´æŠ¤**
```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
./scripts/deploy/main.sh status

# æŸ¥çœ‹æ—¥å¿—
./scripts/deploy/main.sh logs

# å¤‡ä»½æ•°æ®
./scripts/deploy/main.sh backup

# é‡å¯æœåŠ¡
./scripts/deploy/main.sh deploy --restart
```

## ğŸ› ï¸ **æ•…éšœæ’é™¤**

### **å¸¸è§é—®é¢˜**

1. **SSHè¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥SSHé…ç½®
   ssh daidai-singapore "echo 'test'"
   ```

2. **æ„å»ºå¤±è´¥**
   ```bash
   # æ£€æŸ¥Node.jsç‰ˆæœ¬
   node --version
   npm --version
   ```

3. **éƒ¨ç½²å¤±è´¥**
   ```bash
   # æ£€æŸ¥Docker
   docker --version
   docker compose version
   ```

4. **JC21é…ç½®é—®é¢˜**
   ```bash
   # é‡ç½®JC21é…ç½®
   ./scripts/deploy/main.sh config --reset
   ```

## ğŸ“ˆ **ä¼˜åŠ¿å¯¹æ¯”**

### **æ—§è„šæœ¬é—®é¢˜**
- âŒ åŠŸèƒ½æ··æ‚ï¼Œéš¾ä»¥ç»´æŠ¤
- âŒ é”™è¯¯å¤„ç†ä¸ç»Ÿä¸€
- âŒ é…ç½®åˆ†æ•£
- âŒ éš¾ä»¥æ‰©å±•

### **æ–°ç³»ç»Ÿä¼˜åŠ¿**
- âœ… **æ¨¡å—åŒ–è®¾è®¡** - åŠŸèƒ½åˆ†ç¦»ï¼Œæ˜“äºç»´æŠ¤
- âœ… **ç»Ÿä¸€é”™è¯¯å¤„ç†** - ä¸€è‡´çš„æ—¥å¿—å’Œé”™è¯¯å¤„ç†
- âœ… **é…ç½®é›†ä¸­ç®¡ç†** - ç¯å¢ƒå˜é‡ç»Ÿä¸€ç®¡ç†
- âœ… **æ˜“äºæ‰©å±•** - æ–°åŠŸèƒ½åªéœ€æ·»åŠ æ–°æ¨¡å—
- âœ… **å¯å¤ç”¨æ€§** - é€šç”¨åŠŸèƒ½å¯è¢«å¤šä¸ªæ¨¡å—ä½¿ç”¨

## ğŸ”„ **è¿ç§»æŒ‡å—**

### **ä»æ—§è„šæœ¬è¿ç§»**
1. **å¤‡ä»½ç°æœ‰è„šæœ¬**
   ```bash
   cp scripts/deploy-to-singapore.sh scripts/deploy-to-singapore.sh.backup
   ```

2. **ä½¿ç”¨æ–°ç³»ç»Ÿ**
   ```bash
   # æ›¿æ¢æ—§å‘½ä»¤
   # æ—§: ./scripts/deploy-to-singapore.sh --deploy
   # æ–°: ./scripts/deploy/main.sh deploy --full
   ```

3. **æ›´æ–°CI/CD**
   ```bash
   # åœ¨CI/CDä¸­ä½¿ç”¨æ–°å‘½ä»¤
   ./scripts/deploy/main.sh build --all
   ./scripts/deploy/main.sh deploy --full
   ```

## ğŸ¯ **æœ€ä½³å®è·µ**

1. **ç¯å¢ƒéš”ç¦»** - ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†é…ç½®
2. **é”™è¯¯å¤„ç†** - æ‰€æœ‰æ“ä½œéƒ½æœ‰é”™è¯¯å¤„ç†
3. **æ—¥å¿—è®°å½•** - è¯¦ç»†çš„æ“ä½œæ—¥å¿—
4. **æ¨¡å—å¤ç”¨** - é¿å…ä»£ç é‡å¤
5. **æµ‹è¯•éªŒè¯** - éƒ¨ç½²åè‡ªåŠ¨æµ‹è¯•

## ğŸ“ **æ‰©å±•æŒ‡å—**

### **æ·»åŠ æ–°æ¨¡å—**
1. åœ¨`modules/`ç›®å½•åˆ›å»ºæ–°è„šæœ¬
2. ç»§æ‰¿`common.sh`çš„åŠŸèƒ½
3. åœ¨`main.sh`ä¸­æ·»åŠ æ¨¡å—å…¥å£
4. æ›´æ–°æ–‡æ¡£

### **æ·»åŠ æ–°åŠŸèƒ½**
1. åœ¨ç›¸åº”æ¨¡å—ä¸­æ·»åŠ å‡½æ•°
2. æ›´æ–°å¸®åŠ©ä¿¡æ¯
3. æ·»åŠ é”™è¯¯å¤„ç†
4. æµ‹è¯•åŠŸèƒ½

---

**è¿™ä¸ªæ–°çš„éƒ¨ç½²ç³»ç»Ÿæä¾›äº†æ›´å¥½çš„å¯ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§å’Œé”™è¯¯å¤„ç†èƒ½åŠ›ï¼** ğŸš€ 


æ£€æŸ¥å‰ç«¯æ˜¯å¦å·¥ä½œï¼š
```
sudo docker exec avatar-mgmt-nginx-proxy-manager-1 curl -s http://frontend:80
```

æ£€æŸ¥APIæ˜¯å¦å·¥ä½œï¼š
```
sudo docker exec avatar-mgmt-nginx-proxy-manager-1 curl -s http://api:3000/health
```
